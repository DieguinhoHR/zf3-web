---
layout: issue
title: "Subclasses of HeadMeta view helper could implement new meta types more easily by refactoring a single preg_match() pattern into a protected member."
id: ZF-10839
---

ZF-10839: Subclasses of HeadMeta view helper could implement new meta types more easily by refactoring a single preg\_match() pattern into a protected member.
--------------------------------------------------------------------------------------------------------------------------------------------------------------

 Issue Type: Improvement Created: 2010-12-16T23:07:43.000+0000 Last Updated: 2011-02-13T21:03:34.000+0000 Status: Open Fix version(s): 
 Reporter:  David Weinraub (papayasoft)  Assignee:  Matthew Weier O'Phinney (matthew)  Tags: - Zend\_View
 
 Related issues: 
 Attachments: 
### Description

A recent question on StackOverflow asked about how to make the HeadMeta view helper output a tag like:

<meta property="mykey" content="myvalue">

Essentially, adding a new "property" as a new type of meta key.

The solution - subclassing HeadMeta - is straight-forward enough:

1. Modify the preg\_match pattern used in the \_\_call() method
2. Override the protected member $\_keyTypes
3. Override the protected method \_normalizeType().

But the preg\_match pattern used in Zend\_View\_Helper\_HeadMeta::\_\_call() method is inline. To override it, the subclass ends up duplicating nearly the entire \_\_call method, simply to change the pattern from:

'/^(?Pset|(pre|ap)pend|offsetSet)(?PName|HttpEquiv)$/'

to

'/^(?Pset|(pre|ap)pend|offsetSet)(?PName|HttpEquiv|Property)$/'

It would be easier if this pattern were refactored out into a protected member. Then subclass would only have to override the protected member rather than duplicate so much of the parent's\_\_call() method.

Just a thought...

Thanks and cheers! ;-)

 

 

### Comments

Posted by David Weinraub (papayasoft) on 2010-12-16T23:14:00.000+0000

I have a patch (based on what I currently see in trunk, r23526) that implements the change:

This patch file was generated by NetBeans IDE
=============================================

It uses platform neutral UTF-8 encoding and \\n newlines.
=========================================================

--- Base (BASE) +++ Locally Modified (Based On LOCAL) @@ -42,6 +42,7 @@ protected $\_typeKeys = array('name', 'http-equiv', 'charset'); protected $\_requiredKeys = array('content'); protected $\_modifierKeys = array('lang', 'scheme'); + protected $\_callPattern = '/^(?Pset|(pre|ap)pend|offsetSet)(?PName|HttpEquiv)$/';

 
     /**
      * @var string registry key


@@ -125,7 +126,7 @@ \*/ public function \_\_call($method, $args) { - if (preg\_match('/^(?Pset|(pre|ap)pend|offsetSet)(?PName|HttpEquiv)$/', $method, $matches)) { + if (preg\_match($this->\_callPattern, $method, $matches)) { $action = $matches['action']; $type = $this->\_normalizeType($matches['type']); $argc = count($args);

But I confess to being such a noob that I'm not sure that I even created/submitted the patch right. And I regret that I do not have unit-testing for the framework all set up on my dev environment. Please be kind. ;-)

 

 

Posted by David Weinraub (papayasoft) on 2010-12-16T23:21:33.000+0000

I obviously botched the patch submission. Obviously needed some wiki markup. D'oh.

Trying again. As before, patch relative to r23526:

 
    <pre class="literal">
    # This patch file was generated by NetBeans IDE
    # It uses platform neutral UTF-8 encoding and \n newlines.
    --- Base (BASE)
    +++ Locally Modified (Based On LOCAL)
    @@ -42,6 +42,7 @@
         protected $_typeKeys     = array('name', 'http-equiv', 'charset');
         protected $_requiredKeys = array('content');
         protected $_modifierKeys = array('lang', 'scheme');
    +    protected $_callPattern  = '/^(?Pset|(pre|ap)pend|offsetSet)(?PName|HttpEquiv)$/';
     
         /**
          * @var string registry key
    @@ -125,7 +126,7 @@
          */
         public function __call($method, $args)
         {
    -        if (preg_match('/^(?Pset|(pre|ap)pend|offsetSet)(?PName|HttpEquiv)$/', $method, $matches)) {
    +        if (preg_match($this->_callPattern, $method, $matches)) {
                 $action = $matches['action'];
                 $type   = $this->_normalizeType($matches['type']);
                 $argc   = count($args);
    


Aaah, well that's a little better. ;-)

 

 

Posted by David Weinraub (papayasoft) on 2010-12-30T21:37:36.000+0000

Correct spelling error in the title. (In the title, for crying out loud! I need to be more careful)

 

 

Posted by Weber Chris (chris.lu) on 2011-02-13T11:44:25.000+0000

There is a method "appendProperty" in the headMeta helper that could be used for this Link to documentation that shows an example: [http://framework.zend.com/manual/en/â€¦](http://framework.zend.com/manual/en/zend.view.helpers.html#zend.view.helpers.initial.headmeta)

Unfotunatly it doesn't work because the helper only allows this for xhtml1\_rdfa doctypes, if you want to use it on your html5 website because for example you want to include the facebook iLike button you should extend the headMeta helper and override the \_isValid Method

i replaced those lines:

 
    <pre class="highlight">
            //  is only supported with doctype RDFa
            if (!$this->view->doctype()->isRdfa()
                && $item->type === 'property') {
                return false;
            }


with these lines:

 
    <pre class="highlight">
            //  is only supported with doctype RDFa and doctype HTML5
            if (!$this->view->doctype()->isRdfa() && $item->type === 'property' &&
                !$this->view->doctype()->isHtml5() && $item->type === 'property') {
                return false;
            }


you could use this code:

 
    <pre class="highlight">
    
    class myHeadMeta extends Zend_View_Helper_HeadMeta {
    
        /**
         * Determine if item is valid
         *
         * @param  mixed $item
         * @return boolean
         */
        protected function _isValid($item)
        {
            if ((!$item instanceof stdClass)
                || !isset($item->type)
                || !isset($item->modifiers))
            {
                return false;
            }
    
            if (!isset($item->content)
            && (! $this->view->doctype()->isHtml5()
            || (! $this->view->doctype()->isHtml5() && $item->type !== 'charset'))) {
                return false;
            }
    
            //  is only supported with doctype RDFa
            if (!$this->view->doctype()->isRdfa() && $item->type === 'property' &&
                !$this->view->doctype()->isHtml5() && $item->type === 'property') {
                return false;
            }
    
            return true;
        }
    
    }


 

 

Posted by David Weinraub (papayasoft) on 2011-02-13T21:03:18.000+0000

Well, I'm clearly a total bonehead. I was looking at an earlier version.

[Side note: Pleased to see that the implementation of "appendProperty()" is pretty much as I was suggesting: per modification of the regex in the "\_\_call()" method.]

Still, I guess this resolves the issue, eh?

Thanks and cheers!

 

 