---
layout: issue
title: "&quot;Unknows Definition&quot; error when sending simple untyped objects"
id: ZF-9345
---

ZF-9345: "Unknows Definition" error when sending simple untyped objects
-----------------------------------------------------------------------

 Issue Type: Bug Created: 2010-03-05T17:27:26.000+0000 Last Updated: 2011-02-04T12:45:34.000+0000 Status: Open Fix version(s): 
 Reporter:  Eric Heimburg (ericheimburg)  Assignee:  Wade Arnold (wadearnold)  Tags: - Zend\_Amf
 
 Related issues: 
 Attachments: - [example.as](/issues/secure/attachment/12834/example.as)
- [input.bin](/issues/secure/attachment/12833/input.bin)
- [test.php](/issues/secure/attachment/12832/test.php)
 
### Description

I upgraded to PHP 5.3.2 and Zend Framework 1.10.2 at the same time. Afterwards, a simple AMF call that used to work no longer does. When passing several untyped arrays ("Object" types from Flex) to the PHP function, the result is the following exception, which makes no sense to me:

**Fatal error**: Uncaught exception 'Zend\_Amf\_Exception' with message 'Unknows Definition reference: 0' in C:\\svn\\zend\\ZendFramework-1.10.2-minimal\\library\\Zend\\Amf\\Parse\\Amf3\\Deserializer.php:304 Stack trace:

0 C:\\svn\\zend\\ZendFramework-1.10.2-minimal\\library\\Zend\\Amf\\Parse\\Amf3\\Deserializer.php(106): Zend\_Amf\_Parse\_Amf3\_Deserializer->readObject()
=========================================================================================================================================================

1 C:\\svn\\zend\\ZendFramework-1.10.2-minimal\\library\\Zend\\Amf\\Parse\\Amf0\\Deserializer.php(293): Zend\_Amf\_Parse\_Amf3\_Deserializer->readTypeMarker()
=============================================================================================================================================================

2 C:\\svn\\zend\\ZendFramework-1.10.2-minimal\\library\\Zend\\Amf\\Parse\\Amf0\\Deserializer.php(130): Zend\_Amf\_Parse\_Amf0\_Deserializer->readAmf3TypeMarker()
=================================================================================================================================================================

3 C:\\svn\\zend\\ZendFramework-1.10.2-minimal\\library\\Zend\\Amf\\Parse\\Amf0\\Deserializer.php(217): Zend\_Amf\_Parse\_Amf0\_Deserializer->readTypeMarker()
=============================================================================================================================================================

4 C:\\svn\\zend\\ZendFramework-1.10.2-minimal\\library\\Zend\\Amf\\Parse\\Amf0\\Deserializer.php(106): Zend\_Amf\_Parse\_Amf0\_Deserializer->readArray()
========================================================================================================================================================

5 C:\\svn\\zend\\ZendFramework-1.10.2-minimal\\library\\Zend\\Amf\\Request.php(173): Zend\_Amf\_Parse\_Amf0\_Deseria in **C:\\svn\\zend\\ZendFramework-1.10.2-minimal\\library\\Zend\\Amf\\Request.php** on line **176**  

===========================================================================================================================================================================================================================

I will attach a skeleton PHP sample that exhibits the behavior. The calling code is a Flex function that looks like so:

 
        public function login(username:String, password:String):void
        {
            var session:Object = new Object();
            session['code'] = _sessionID;
    
            var loginInfo:Object = new Object();
            loginInfo['username'] = username;
            loginInfo['password'] = SHA1.encrypt(_authSalt+password);
    
            var everything:Object = new Object();
            everything['session_info'] = session;
            everything['login_method'] = "password";
            everything['login_blob'] = loginInfo;
    
            var responder:Responder = new Responder(onLogin, onNetworkingError);
            _conn.call("XCRpcProtocol_AMF.login", responder, session, "password", loginInfo);
        }


In this example case it is called with both parameters set to "". I will attach the binary input (saved from Charles proxy) in case you have a method of importing it directly, to simplify repro. Thanks!

 

 

### Comments

Posted by Eric Heimburg (ericheimburg) on 2010-03-05T17:31:15.000+0000

test.php is a very simple example that does nothing much. (I am sure you will need to change the include path, I was making sure that the correct Zend library was getting used.)

input.bin is the binary data that is generated by the Flex client application, which causes the error.

 

 

Posted by Eric Heimburg (ericheimburg) on 2010-03-05T17:34:19.000+0000

The code snippet I pasted originally got malformed; here it is again as example.as. Not actually runnable, but it's pretty understandable (as it doesn't do much).

 

 

Posted by Max Wagner (emeyex) on 2011-02-04T11:56:36.000+0000

Same exact exception and callstack. Using ZendFramework 1.11.3, PHP 5.3.2. In my case, it's only when I add a third argument to my PHP function, and only when that third argument is an object (can pass string and int fine).

in PHP service: function failsToGetCalledFromAS3($tableName, $rowAsObject, $whereExpression) { return TRUE; }

from AS3: connection.gateway.call("DevDb.failsToGetCalledFromAS3",new Responder(onResponse,onFault),tableName,row,{someValue:"128"});

 

 

Posted by Max Wagner (emeyex) on 2011-02-04T12:45:33.000+0000

The obvious workaround I guess is just to pass all parameters to RPCs as a single array of arguments, and extract them inside my own functions. Seems a little ghetto but it works so far.

 

 