---
layout: issue
title: "Zend_Paginator_Adapter_DbSelect-&gt;getCountSelect() - the count query produced by this method fails if the original Zend_Db_Select contains &quot;order by&quot; (and using Zend_Db_Adapter_Sqlsrv)"
id: ZF-10947
---

ZF-10947: Zend\_Paginator\_Adapter\_DbSelect->getCountSelect() - the count query produced by this method fails if the original Zend\_Db\_Select contains "order by" (and using Zend\_Db\_Adapter\_Sqlsrv)
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

 Issue Type: Bug Created: 2011-01-14T03:31:04.000+0000 Last Updated: 2011-02-18T07:41:26.000+0000 Status: Resolved Fix version(s): - 1.11.4 (03/Mar/11)
 
 Reporter:  Ian Smith (smivz)  Assignee:  Ramon Henrique Ornelas (ramon)  Tags: - Zend\_Paginator
 
 Related issues: 
 Attachments: 
### Description

Zend\_Paginator\_Adapter\_DbSelect->getCountSelect() - the count query produced by this method fails if the original Zend\_Db\_Select contains "order by" (and using Zend\_Db\_Adapter\_Sqlsrv).

The sql generated by the Zend\_Db\_Select object is ok:

$select = $db->select() ->from(array('icp' => 'icn\_ptnt'), array('Surname', 'Firstname')) ->join(array('apm' => 'abx\_patient\_medications'), 'icp.Patient\_No = apm.patient\_id', array()) ->group(array('Surname', 'Firstname')) ->order(array('Surname'));

SELECT "icp"."Surname", "icp"."Firstname" FROM "icn\_ptnt" AS "icp" INNER JOIN "abx\_patient\_medications" AS "apm" ON icp.Patient\_No = apm.patient\_id GROUP BY "Surname", "Firstname" ORDER BY "Surname" ASC

However, an error is encoutered once this is passed to Zend\_Paginator

$view->paginator = Zend\_Paginator::factory($select); $view->paginator->setCurrentPageNumber((isset($\_GET['page'])) ? $\_GET['page'] : 1); $view->paginator->setItemCountPerPage(100);

SELECT COUNT(1) AS "zend\_paginator\_row\_count" FROM (SELECT "icp"."Surname", "icp"."Firstname" FROM "icn\_ptnt" AS "icp" INNER JOIN "abx\_patient\_medications" AS "apm" ON icp.Patient\_No = apm.patient\_id GROUP BY "Surname", "Firstname" ORDER BY "Surname" ASC) AS "t"

Msg 1033, Level 15, State 1, Line 3 The ORDER BY clause is invalid in views, inline functions, derived tables, subqueries, and common table expressions, unless TOP or FOR XML is also specified.

 

 

### Comments

Posted by Ramon Henrique Ornelas (ramon) on 2011-02-18T07:41:26.000+0000

Fixed in trunk r23724 merged to branch release 1.11 r23725.

 

 