---
layout: issue
title: "Problems on Zend_Controller_Router_Route with assemble and _values"
id: ZF-2106
---

ZF-2106: Problems on Zend\_Controller\_Router\_Route with assemble and \_values
-------------------------------------------------------------------------------

 Issue Type: Bug Created: 2007-10-27T08:33:15.000+0000 Last Updated: 2007-11-17T06:48:56.000+0000 Status: Resolved Fix version(s): 
 Reporter:  Cristian Bichis (avantis)  Assignee:  Michal Minicki (martel)  Tags: - Zend\_Controller
 
 Related issues: 
 Attachments: 
### Description

Hello,

There is a problem with custom routes due to the way assemble function works with \_values member.

match function is setting \_values here:

 
    <pre class="highlight">
                    if ($name !== null) {
                        // It's a variable. Setting a value
                        $this->_values[$name] = $pathPart;
                        $unique[$name] = true;
                    } else {
                        $pathStaticCount++;
                    }


Problem is if we use assemble function to generate url's then on url to be created are automatically added params from \_values

 
    <pre class="highlight">
      } elseif (!$reset && !$resetPart && isset($this->_values[$part['name']])) {
        $url[$key] = $this->_values[$part['name']];


Sample: if i create a custom route and i am having these base params: page\_id, language, name and some optional params, all links generated on a page which has a URL with an optional param then all links generated by assemble automatically contains the params from \_values... Which is a bug of course...

 

 

### Comments

Posted by Cristian Bichis (avantis) on 2007-11-13T10:01:53.000+0000

No feedback yet on this problem ?

 

 

Posted by Matthew Weier O'Phinney (matthew) on 2007-11-16T14:50:19.000+0000

Assigning to Martel.

 

 

Posted by Michal Minicki (martel) on 2007-11-16T15:46:42.000+0000

I'm not sure I fully understand what you're getting at here, Cristian. Could you provide some more detailed code examples (routes) and the results you expect to get?

 

 

Posted by Cristian Bichis (avantis) on 2007-11-16T18:46:02.000+0000

Hello,

Route is this:

routes.default.type = "Imagis\_Controller\_Router\_Route" routes.default.route = ":seo\_:page\_:language\_:v1\_:v2" routes.default.defaults.seo = "site description" routes.default.defaults.page = 1 routes.default.defaults.language = ro routes.default.defaults.v1 = 0 routes.default.defaults.v2 = 0

seo and page are required.

Ok, now on pages if i have on one of the first links on page generated by assemble language and v1 defined then ALL the links on page will get language and v1... Due to this

} elseif (!$reset && !$resetPart && isset($this->\_values[$part['name']])) { $url[$key] = $this->\_values[$part['name']];

 

 

Posted by Michal Minicki (martel) on 2007-11-17T06:39:56.000+0000

You still haven't told me what do you expect to get.

Now, with your test data it works this way:

 
    <pre class="highlight">
    $route = new Zend_Controller_Router_Route(
      ":seo/:page/:language/:v1/:v2",
      array(
        'seo' => "site description",
        'page' => 1,
        'language' => 'ro',
        'v1' => 0,
        'v2' => 0
      )
    );
    
    $values = $route->match('desc/2/pl/3');
    
    var_dump($values);
    
    $url = $route->assemble();
    
    var_dump($url);
    
    $url = $route->assemble(array('v1' => 4));
    
    var_dump($url);


Which results in:

 
    <pre class="highlight">
    array(5) {
      ["seo"]=>
      string(4) "desc"
      ["page"]=>
      string(1) "2"
      ["language"]=>
      string(2) "pl"
      ["v1"]=>
      string(1) "3"
      ["v2"]=>
      int(0)
    }
    string(11) "desc/2/pl/3"
    string(11) "desc/2/pl/4"


And it seems fine to me.

 

 

Posted by Michal Minicki (martel) on 2007-11-17T06:48:56.000+0000

More examples to show you how it's supposed to work:

 
    <pre class="highlight">
    $url = $route->assemble(array('v1' => null));
    
    var_dump($url);
    
    $url = $route->assemble(array('page' => 2), true);
    
    var_dump($url);
    
    $url = $route->assemble(array('v1' => 4), true);
    
    var_dump($url);


Results in:

 
    <pre class="highlight">
    string(9) "desc/2/pl"
    string(18) "site description/2"
    string(23) "site description/1/ro/4"


If it does not resolve your issue, then please give some more detailed examples and expected values. Or better yet write a test case that I could run and see for myself. I'll reopen the ticket them.

 

 