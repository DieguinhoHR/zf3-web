---
layout: issue
title: "DB2 lastInsertId() gives wrong results in concurrent environment"
id: ZF-871
---

ZF-871: DB2 lastInsertId() gives wrong results in concurrent environment
------------------------------------------------------------------------

 Issue Type: Bug Created: 2007-02-07T21:01:14.000+0000 Last Updated: 2007-07-05T14:43:45.000+0000 Status: Resolved Fix version(s): - 0.8.0 (21/Feb/07)
 
 Reporter:  Bill Karwin (bkarwin)  Assignee:  Bill Karwin (bkarwin)  Tags: - Zend\_Db
 
 Related issues: 
 Attachments: 
### Description

The lastInsertId() method implementation for the DB2 native adapter discovers the last inserted value for a table by querying MAX() on the table. This causes wrong results if other clients have inserted values to the table since the latest INSERT performed by the current client.

Retrieving the value last generated by an INSERT must be limited to the scope of the current process; it must not return values generated by other processes.

DB2 offers a builtin function IDENTITY\_VAL\_LOCAL() which is similar to MySQL's LAST\_INSERTID(). It returns the last value generated by a sequence object or a generated identity column, limited to the scope of the current process. This is the correct solution to use.

Unfortunately, this solution does not allow one to limit the query to values generated for a specific table. It only returns the last value generated in any table or sequence, in the current process.

 

 

### Comments

Posted by Bill Karwin (bkarwin) on 2007-02-07T21:05:05.000+0000

Fixed in revision 3284.

 

 