---
layout: issue
title: "Enable/disable referentical contraint checking"
id: ZF-10473
---

ZF-10473: Enable/disable referentical contraint checking
--------------------------------------------------------

 Issue Type: New Feature Created: 2010-09-19T14:52:01.000+0000 Last Updated: 2011-03-15T09:58:51.000+0000 Status: Resolved Fix version(s): 
 Reporter:  Rafal Radulski (rrafal)  Assignee:  Dolf Schimmel (Freeaqingme) (freak)  Tags: - Zend\_Db
 
 Related issues: 
 Attachments: 
### Description

I suggest to add one or two methods to Zend\_Db\_Adapter. They would enable and disable referential constraint checking (or foreign key checking). This is a common feature in databases, but it requires different SQL calls. For example:

MsSQL: ALTER TABLE ? NOCHECK CONSTRAINT ALL MySQL: SET foreign\_key\_checks = 0 SQLite: PRAGMA foreign\_keys = OFF PgSQL: SET CONSTRAINTS ALL DEFERRED (?)

This feature would be useful was setting up database tables during testing, importing data, and dropping multiple tables. It would be used by Zend\_Test\_PHPUnit\_Db\_Operation\_\* classes. I know that it will be difficult or impossible to implement this consistently across all databases. However, I think it would be much worth it.

I suggest the following methods: enableReferentialConstraints() disableReferentialConstraints() or: enableReferentialConstraints(boolean)

usage: $connection->enableReferentialConstriants(true); try{ // execute SQL statments // $connection->enableReferentialConstriants(false); } catch(Exception ex) { $connection->enableReferentialConstriants(false); // handle or re-throw exception }

 

 

### Comments

Posted by Shawn Ostler (sosy) on 2011-03-11T12:48:26.000+0000

For SQLite, I am currently extending the Db\_Adapter simply to turn on foreign keys. This should be added, at least for SQLite, since foreign keys are disabled.

-application.ini

resources.db.adapter = "pdo\_sqlite" resources.db.params.dbname = APPLICATION\_PATH "/../database/production.sqlite3" resources.db.params.adapterNamespace = 'My\_Db\_Adapter' resources.db.params.enable\_foreign\_keys = 1

<?php

class My\_Db\_Adapter\_Pdo\_Sqlite extends Zend\_Db\_Adapter\_Pdo\_Sqlite {

 
    protected function _connect() {
    
        /**
         * if we already have a PDO object, no need to re-connect.
         */
        if ($this->_connection) {
            return;
        }
    
        parent::_connect();
    
        if (isset($this->_config['enable_foreign_keys'])  && $this->_config['enable_foreign_keys']) {
            $q = $this->_profiler->queryStart('enable_foreign_keys');
    
            $retval = $this->_connection->exec('PRAGMA foreign_keys=1');
            if ($retval === false) {
                $error = $this->_connection->errorInfo();
                /** @see Zend_Db_Adapter_Exception */
                require_once 'Zend/Db/Adapter/Exception.php';
                throw new Zend_Db_Adapter_Exception($error[2]);
            }
    
            $this->_profiler->queryEnd($q);
        }
    
    }


}

 

 

Posted by Dolf Schimmel (Freeaqingme) (freak) on 2011-03-12T09:30:02.000+0000

Why would you want to have this feature implemented? If it's something you use regularly (or anywhere) you're doing something wrong. If you don't want referential integrity, then I'd suggest you simply don't enable it in your RDBMS in the first place.

 

 

Posted by Shawn Ostler (sosy) on 2011-03-15T09:50:50.000+0000

You are absolutely right and thank you for pointing this out. I have created another issue, <http://framework.zend.com/issues/browse/ZF-11176>, where I ask for enabling, only in sqlite and also to deny disabling.

 

 

Posted by Dolf Schimmel (Freeaqingme) (freak) on 2011-03-15T09:58:51.000+0000

Resolving issue as wont fix.

 

 