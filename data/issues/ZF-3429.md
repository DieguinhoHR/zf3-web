---
layout: issue
title: "Dangerous use of lastInsertId and lastSequenceId"
id: ZF-3429
---

ZF-3429: Dangerous use of lastInsertId and lastSequenceId
---------------------------------------------------------

 Issue Type: Docs: Problem Created: 2008-06-10T05:47:33.000+0000 Last Updated: 2008-06-15T21:29:53.000+0000 Status: Resolved Fix version(s): 
 Reporter:  Ric C (lionheart33806)  Assignee:  Ralph Schindler (ralph)  Tags: - Zend\_Db
 
 Related issues: 
 Attachments: 
### Description

Hi,

Well, I'm not a "Zend Framework" developper but I saw a big problem in the doc.

In <http://framework.zend.com/manual/en/zend.db.html>, we can see :

$db->insert('bugs', $data);

// return the last value generated by sequence 'bugs\_id\_gen'. $id = $db->lastSequenceId('bugs\_id\_gen');

I read the ZF code and I think I can say that using lastInsertId and lastSequenceId, we can't be sure that the ids are the ones created for the insert command.

Ex : If 2 clients do an insert and then do a lastInsertId (or lastSequenceId), they will have the same id ! It seems that the "good-created" ids are in the returned value of the insert.

Please correct this !

The problem is the same in french version.

Thanks

 

 

### Comments

Posted by julien PAULI (doctorrock83) on 2008-06-10T08:28:12.000+0000

mmm I don't think so. LasterInsertId() should be client aware and fully atomic. That's the main difference between lastInsertId() and some kind of select(max(id)) from table.

Perhaps I'm wrong, I dont know all RDBMs

 

 

Posted by Ric C (lionheart33806) on 2008-06-12T08:08:37.000+0000

Well, I read more about my "issue".

Finally, I didn't know that for _Oracle CURRVAL_ worked only in the current session. In fact, CURRVAL is linked to the NEXTVAL previously used. So, it can't happen multiple users problems.

Sorry for my intervention, you can close the issue.

 

 

Posted by julien PAULI (doctorrock83) on 2008-06-12T08:18:42.000+0000

Not an issue

 

 

Posted by Wil Sinclair (wil) on 2008-06-15T21:29:53.000+0000

Updating to comply with new IT component conventions.

 

 